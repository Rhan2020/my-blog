---
title: "ğŸ” Nginxåå‘ä»£ç†è¿·æ¡ˆï¼šHTTPSè¿æ¥ä¸ºä½•404ï¼Ÿ"
description: "é€šè¿‡åˆ†æè¯·æ±‚æµã€é…ç½®æ–‡ä»¶å’Œé”™è¯¯æ—¥å¿—ï¼Œè§£å†³Nginxåå‘ä»£ç†å¯¼è‡´çš„HTTPS 404é—®é¢˜"
date: "2025-06-11T20:00:00.000Z"
tags: ["æŠ€æœ¯å¼€å‘"]
author: "Rshan"
published: true
---

# ğŸ”ğŸ•µï¸ Nginxåå‘ä»£ç†è¿·æ¡ˆï¼šHTTPSè¿æ¥ä¸ºä½•404ï¼Ÿ

## ğŸŒğŸ˜µ ä¸€ä¸ªè®©äººæŠ“ç‹‚çš„"åŒé¢äºº"ç½‘ç«™

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªç½‘ç«™ï¼Œé€šè¿‡HTTPè®¿é—®ä¸€åˆ‡æ­£å¸¸ï¼Œä½†æ¢æˆHTTPSå°±åƒè¸å…¥äº†å¹³è¡Œå®‡å®™ â€” åŒä¸€ä¸ªç½‘ç«™ï¼ŒåŒä¸€ä¸ªæœåŠ¡å™¨ï¼Œå´è¿”å›404é”™è¯¯ï¼è¿™å°±åƒæ˜¯ä¸€ä¸ª"åŒé¢äºº"ï¼Œä»¥HTTPç¤ºäººæ—¶å½¬å½¬æœ‰ç¤¼ï¼Œä»¥HTTPSç°èº«æ—¶å´è£…ä½œä¸è®¤è¯†ä½ ã€‚

è¿™ä¸ªå¥‡æ€ªçš„ç°è±¡æœ€è¿‘åœ¨æˆ‘çš„åšå®¢é¡¹ç›®ä¸­å‡ºç°äº†ã€‚æˆ‘çš„åšå®¢ä½¿ç”¨Next.jså¼€å‘ï¼Œé€šè¿‡Nginxåå‘ä»£ç†è½¬å‘è¯·æ±‚ã€‚å½“æˆ‘é…ç½®å¥½SSLè¯ä¹¦åï¼ŒHTTPå¯ä»¥è®¿é—®ï¼Œä½†HTTPSå´å›ºæ‰§åœ°è¿”å›404é”™è¯¯ã€‚

![404é”™è¯¯](https://images.unsplash.com/photo-1594498653385-d5172c532c00?w=800&q=80)

```bash
# âœ… HTTPè¯·æ±‚ - åƒé˜³å…‰ä¸‹çš„æ­£å¸¸äºº
curl -I http://******.***
HTTP/1.1 200 OK
Server: nginx/1.18.0 (Ubuntu)

# âŒ HTTPSè¯·æ±‚ - åƒé»‘å¤œé‡Œçš„é™Œç”Ÿäºº
curl -I https://******.***
HTTP/2 404
server: nginx/1.18.0 (Ubuntu)
```

## ğŸ•µï¸â€â™‚ï¸ğŸ” ä¾¦æ¢å·¥ä½œå¼€å§‹ï¼šå¯»æ‰¾"åŒé¢äºº"çš„ç§˜å¯†

### ğŸ“„ ç¬¬ä¸€æ¡çº¿ç´¢ï¼šæ£€æŸ¥Nginxé…ç½®æ–‡ä»¶

å°±åƒä¾¦æ¢é¦–å…ˆæ£€æŸ¥çŠ¯ç½ªç°åœºä¸€æ ·ï¼Œæˆ‘å…ˆæŸ¥çœ‹äº†Nginxé…ç½®æ–‡ä»¶ï¼š

```bash
sudo cat /etc/nginx/sites-available/default
```

å°†HTTPå’ŒHTTPSé…ç½®å¹¶æ’æ¯”è¾ƒï¼Œå°±åƒå¯¹æ¯”ä¸¤å¼ å«Œç–‘äººç…§ç‰‡ï¼š

```nginx
# ğŸŒ HTTPé…ç½® - è¡Œä¸ºæ­£å¸¸çš„é‚£ä¸€é¢
server {
    listen 80;
    server_name ******.***;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

# ğŸ”’ HTTPSé…ç½® - è¡Œä¸ºå¼‚å¸¸çš„é‚£ä¸€é¢
server {
    listen 443 ssl;
    server_name ******.***;
    
    ssl_certificate /etc/letsencrypt/live/******.***/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/******.***/privkey.pem;
    
    location / {
        # ğŸ˜± å•Šå“ˆï¼è¿™é‡Œå°‘äº†proxy_passæŒ‡ä»¤ï¼Œå°±åƒç¼ºå°‘äº†å¤§è„‘çš„åƒµå°¸!
    }
}
```

å‘ç°äº†ï¼å°±åƒä¾¦æ¢æ‰¾åˆ°äº†å…³é”®çº¿ç´¢ â€” HTTPSé…ç½®å—ä¸­ç¼ºå°‘äº†`proxy_pass`æŒ‡ä»¤ï¼è¿™å°±åƒä¸€ä¸ªäº¤é€šæŒ‡æŒ¥å‘˜å¿˜è®°äº†å‘Šè¯‰è½¦è¾†å¾€å“ªä¸ªæ–¹å‘è¡Œé©¶ï¼Œæ‰€æœ‰çš„HTTPSè¯·æ±‚éƒ½ä¸çŸ¥é“è¯¥å»å“ªé‡Œã€‚

### ğŸ“œ ç¬¬äºŒæ¡çº¿ç´¢ï¼šé”™è¯¯æ—¥å¿—ä¸­çš„è››ä¸é©¬è¿¹

ä¸ºäº†ç¡®è®¤æˆ‘çš„çŒœæµ‹ï¼Œæˆ‘æŸ¥çœ‹äº†Nginxçš„é”™è¯¯æ—¥å¿—ï¼Œå°±åƒé˜…è¯»çŠ¯ç½ªå«Œç–‘äººçš„æ—¥è®°ï¼š

```bash
sudo tail -n 50 /var/log/nginx/error.log
```

é”™è¯¯æ—¥å¿—æ­ç¤ºäº†æ›´å¤šä¿¡æ¯ï¼š

```
2025/06/10 15:42:11 [error] 12345#12345: *123 directory index of "/var/www/html/" is forbidden, client: ***.***.***.***, server: ******.***
```

è¿™æ¡æ—¥å¿—å°±åƒæ˜¯ä¸€å°è‡ªç™½ä¿¡ï¼å®ƒå‘Šè¯‰æˆ‘ä»¬ï¼šHTTPSè¯·æ±‚æ²¡æœ‰è¢«è½¬å‘åˆ°Node.jsåº”ç”¨ï¼Œè€Œæ˜¯è¢«é”™è¯¯åœ°å¼•å¯¼åˆ°é»˜è®¤çš„`/var/www/html/`ç›®å½•ï¼Œå°±åƒä¸€ä¸ªè¯¯å…¥æ­§é€”çš„æ—…è¡Œè€…ã€‚

### ğŸ” ç¬¬ä¸‰æ¡çº¿ç´¢ï¼šç¡®è®¤ä¸æ˜¯è¯ä¹¦é—®é¢˜

æœ€åï¼Œæˆ‘æ£€æŸ¥äº†SSLè¯ä¹¦é…ç½®ï¼Œç¡®ä¿ä¸æ˜¯è¯ä¹¦æœ¬èº«çš„é—®é¢˜ï¼š

```bash
sudo certbot certificates
```

è¾“å‡ºæ˜¾ç¤ºè¯ä¹¦å®Œå…¨æœ‰æ•ˆï¼Œå°±åƒç¡®è®¤å«Œç–‘äººçš„ä¸åœ¨åœºè¯æ˜ï¼š

```
Certificate Name: ******.***
    Domains: ******.***
    Expiry Date: 2025-09-10 12:30:45+00:00 (âœ… VALID: 89 days)
    Certificate Path: /etc/letsencrypt/live/******.***/fullchain.pem
    Private Key Path: /etc/letsencrypt/live/******.***/privkey.pem
```

è‡³æ­¤ï¼Œæ¡ˆæƒ…å·²ç»æ˜äº†ï¼šSSLé…ç½®å·¥ä½œæ­£å¸¸ï¼Œé—®é¢˜å°±æ˜¯ç¼ºå°‘äº†ä»£ç†è½¬å‘é…ç½®ã€‚å°±åƒä¸€ä¸ªé‚®é€’å‘˜çŸ¥é“ä½ çš„åœ°å€ä½†å¿˜è®°äº†æŠŠä¿¡é€åˆ°ä½ å®¶é—¨å£ã€‚

![è°ƒæŸ¥è¿‡ç¨‹](https://images.unsplash.com/photo-1575089976121-8ed7b2a54265?w=800&q=80)

## ğŸ”§ğŸ› ï¸ è§£å†³æ–¹æ¡ˆï¼šè®©"åŒé¢äºº"æ¢å¤ç»Ÿä¸€äººæ ¼

### âš™ï¸ ä¿®å¤Nginxé…ç½® - ç»™é‚®é€’å‘˜æŒ‡æ˜æ–¹å‘

è§£å†³æ–¹æ¡ˆéå¸¸ç®€å•ï¼šæ›´æ–°HTTPSé…ç½®å—ï¼Œæ·»åŠ ç¼ºå¤±çš„proxy_passæŒ‡ä»¤ï¼Œå°±åƒç»™è¿·è·¯çš„é‚®é€’å‘˜ä¸€å¼ åœ°å›¾ï¼š

```nginx
server {
    listen 443 ssl;
    server_name ******.***;
    
    ssl_certificate /etc/letsencrypt/live/******.***/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/******.***/privkey.pem;
    
    # âœ¨ æ·»åŠ ä»¥ä¸‹ä»£ç†é…ç½® - å°±åƒç»™é‚®é€’å‘˜æŒ‡æ˜é€ä¿¡çš„åœ°å€
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

åº”ç”¨æ–°é…ç½®å¹¶é‡è½½Nginxï¼Œå°±åƒç»™ç³»ç»Ÿæ³¨å…¥æ–°çš„è®°å¿†ï¼š

```bash
sudo nginx -t       # ğŸ” å…ˆæ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œå°±åƒè¯•ç©¿è¡£æœ
sudo systemctl reload nginx  # ğŸ”„ é‡è½½é…ç½®ï¼Œå°±åƒæ¢ä¸Šæ–°è¡£æœ
```

å†æ¬¡æµ‹è¯•HTTPSè®¿é—®ï¼Œè§è¯å¥‡è¿¹çš„æ—¶åˆ»ï¼š

```bash
curl -I https://******.***
HTTP/2 200
server: nginx/1.18.0 (Ubuntu)
```

å¤ªæ£’äº†ï¼é—®é¢˜è§£å†³ï¼ç°åœ¨æˆ‘ä»¬çš„"åŒé¢äºº"ç½‘ç«™æ¢å¤äº†ç»Ÿä¸€çš„äººæ ¼ï¼Œæ— è®ºæ˜¯HTTPè¿˜æ˜¯HTTPSéƒ½èƒ½æ­£å¸¸è®¿é—®åšå®¢äº†ã€‚å°±åƒJekyllåšå£«ç»ˆäºæ§åˆ¶ä½äº†Hydeå…ˆç”Ÿã€‚

![è§£å†³æ–¹æ¡ˆ](https://images.unsplash.com/photo-1498050108023-c5249f4df085?w=800&q=80)

## ğŸ›¡ï¸ğŸ”’ Nginx HTTPSé…ç½®çš„"ç§˜ç±å¤§å…¨"

### ğŸ“‹ 1. å®Œç¾é…ç½®æ¨¡æ¿ - ä½ çš„Nginxé…ç½®"é£Ÿè°±"

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç»è¿‡å®æˆ˜æ£€éªŒçš„Nginx HTTPSåå‘ä»£ç†é…ç½®æ¨¡æ¿ï¼Œå°±åƒä¸€ä»½ä¸ä¼šå¤±è´¥çš„è›‹ç³•é£Ÿè°±ï¼š

```nginx
server {
    # ğŸ”€ HTTPè‡ªåŠ¨è·³è½¬HTTPS - å°±åƒå•†åº—å‰å°å¼•å¯¼é¡¾å®¢å»VIPåŒº
    listen 80;
    server_name ******.***;
    return 301 https://$host$request_uri;
}

server {
    # ğŸ”’ HTTPSé…ç½® - VIPå®‰å…¨åŒºåŸŸ
    listen 443 ssl;
    server_name ******.***;
    
    # ğŸ“œ SSLè¯ä¹¦é…ç½® - ä½ çš„æ•°å­—èº«ä»½è¯
    ssl_certificate /etc/letsencrypt/live/******.***/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/******.***/privkey.pem;
    
    # âš¡ SSLä¼˜åŒ–å‚æ•° - è®©å®‰å…¨ä¸å½±å“é€Ÿåº¦
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256';
    ssl_session_timeout 1d;
    ssl_session_cache shared:SSL:10m;
    ssl_session_tickets off;
    
    # ğŸ›¡ï¸ å¯ç”¨HSTS - å‘Šè¯‰æµè§ˆå™¨"åªèµ°å®‰å…¨é€šé“"
    add_header Strict-Transport-Security "max-age=31536000" always;
    
    # ğŸ”„ åå‘ä»£ç†é…ç½® - è¯·æ±‚çš„"ä¼ é€é—¨"
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### ğŸ” 2. æ•…éšœæ’æŸ¥æ¸…å• - ä½ çš„Nginx"æ€¥æ•‘æ‰‹å†Œ"

å½“HTTPSè®¿é—®å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥æŒ‰ä»¥ä¸‹æ¸…å•æ’æŸ¥ï¼Œå°±åƒåŒ»ç”Ÿçš„è¯Šæ–­æµç¨‹ï¼š

1. **ğŸ“„ é…ç½®æ–‡ä»¶è¯­æ³•** - ä½¿ç”¨`nginx -t`éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•ï¼Œå°±åƒæ£€æŸ¥æ–‡ç« çš„æ‹¼å†™é”™è¯¯
2. **ğŸ”’ SSLè¯ä¹¦è·¯å¾„** - ç¡®è®¤è¯ä¹¦æ–‡ä»¶è·¯å¾„æ­£ç¡®ä¸”æœ‰è¯»å–æƒé™ï¼Œå°±åƒç¡®è®¤é’¥åŒ™èƒ½æ‰“å¼€é—¨
3. **ğŸ”Œ ä»£ç†è½¬å‘é…ç½®** - ç¡®è®¤`proxy_pass`æŒ‡ä»¤é…ç½®æ­£ç¡®ï¼Œå°±åƒç¡®è®¤GPSå¯¼èˆªè®¾ç½®äº†æ­£ç¡®çš„ç›®çš„åœ°
4. **ğŸ”„ è¯·æ±‚å¤´è½¬å‘** - æ£€æŸ¥æ˜¯å¦æ­£ç¡®è®¾ç½®äº†å¿…è¦çš„è¯·æ±‚å¤´ï¼Œå°±åƒç¡®ä¿ä¿¡å°ä¸Šæœ‰å®Œæ•´çš„åœ°å€ä¿¡æ¯
5. **ğŸ“¶ ç«¯å£ç›‘å¬** - ç¡®è®¤443ç«¯å£å·²æ­£ç¡®ç»‘å®šï¼ˆ`netstat -tulpn | grep nginx`ï¼‰ï¼Œå°±åƒç¡®è®¤ç”µè¯çº¿å·²æ¥å¥½
6. **ğŸ§± é˜²ç«å¢™è®¾ç½®** - æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å…è®¸443ç«¯å£é€šä¿¡ï¼Œå°±åƒç¡®è®¤å¤§é—¨æ²¡æœ‰ä¸Šé”

### ğŸ“Š 3. æ€§èƒ½ä¼˜åŒ–ç§˜ç± - è®©ä½ çš„ç½‘ç«™"é£"èµ·æ¥

ä¸ºç¡®ä¿Nginx HTTPSä»£ç†çš„æœ€ä½³æ€§èƒ½ï¼Œè¿™é‡Œæœ‰å‡ ä¸ª"åŠ é€Ÿå’’è¯­"ï¼š

1. **ğŸ”„ å¯ç”¨HTTP/2** - å°±åƒæŠŠå•è½¦é“å‡çº§ä¸ºé«˜é€Ÿå…¬è·¯
   ```nginx
   listen 443 ssl http2;
   ```

2. **ğŸ“¦ é…ç½®ç¼“å­˜** - å°±åƒç»™å¿«é€’å‘˜ä¸€ä¸ªä¸´æ—¶ä»“åº“ï¼Œä¸ç”¨æ¯æ¬¡éƒ½è·‘å›æ€»éƒ¨
   ```nginx
   proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m inactive=60m;
   location / {
       proxy_cache my_cache;
       proxy_cache_valid 200 302 10m;
       proxy_cache_valid 404 1m;
   }
   ```

3. **âš¡ å¯ç”¨å‹ç¼©** - å°±åƒæŠŠè¡ŒæçœŸç©ºå‹ç¼©ï¼Œå ç”¨æ›´å°‘ç©ºé—´
   ```nginx
   gzip on;
   gzip_types text/plain text/css application/json application/javascript;
   gzip_min_length 1000;
   ```

4. **â±ï¸ è°ƒæ•´è¶…æ—¶è®¾ç½®** - ç»™æ…¢ä¸€ç‚¹çš„å®¢äººå¤šä¸€ç‚¹ç­‰å¾…æ—¶é—´
   ```nginx
   proxy_connect_timeout 60s;
   proxy_send_timeout 60s;
   proxy_read_timeout 60s;
   ```

5. **ğŸ”¢ è°ƒæ•´å·¥ä½œè¿›ç¨‹æ•°** - é›‡ä½£é€‚é‡çš„"å‘˜å·¥"å¤„ç†è¯·æ±‚
   ```nginx
   # nginx.confä¸­
   worker_processes auto;
   ```

## ğŸ’­ ä½ æœ‰æ²¡æœ‰é‡åˆ°è¿‡ç±»ä¼¼çš„"åŒé¢äºº"ç½‘ç«™é—®é¢˜ï¼Ÿ

ä½ æ˜¯å¦ä¹Ÿæ›¾é‡åˆ°è¿‡é…ç½®çœ‹ä¼¼æ­£ç¡®ä½†å°±æ˜¯ä¸å·¥ä½œçš„æƒ…å†µï¼Ÿæˆ–è€…æ˜¯å…¶ä»–è®©ä½ æŠ“ç‹‚çš„Nginxé…ç½®é—®é¢˜ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„æ•…äº‹å’Œè§£å†³æ–¹æ³•ï¼

è®°ä½ï¼Œåœ¨WebæœåŠ¡å™¨é…ç½®çš„ä¸–ç•Œé‡Œï¼Œç»†èŠ‚å†³å®šæˆè´¥ï¼Œä¸€ä¸ªç¼ºå¤±çš„æŒ‡ä»¤å°±å¯èƒ½å¯¼è‡´æ•´ä¸ªç³»ç»Ÿè¡Œä¸ºå¼‚å¸¸ã€‚å°±åƒçƒ¹é¥ªä¸€æ ·ï¼Œå°‘äº†ä¸€å‘³è°ƒæ–™ï¼Œæ•´é“èœçš„å‘³é“å°±ä¼šå¤§ä¸ç›¸åŒï¼ 